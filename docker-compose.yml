services:
    db:
        container_name: 'db'
        image: postgres:16-alpine
        restart: always
        environment:
            POSTGRES_USER: notizap
            POSTGRES_PASSWORD: notizappass
            POSTGRES_DB: notizap
        volumes:
            - db-data:/var/lib/postgresql/data
        ports:
            - '5432:5432'
        healthcheck:
            test: ['CMD-SHELL', 'pg_isready -U notizap -d notizap']
            interval: 10s
            timeout: 5s
            retries: 5
    redis:
        container_name: redis
        image: redis:7-alpine
        restart: always
        command: ['redis-server', '--appendonly', 'yes']
        ports:
            - '6379:6379'
        volumes:
            - redis-data:/data
        healthcheck:
            test: ['CMD', 'redis-cli', 'ping']
            interval: 10s
            timeout: 5s
            retries: 5

    evolution-api:
        container_name: evolution-api
        image: evoapicloud/evolution-api:latest
        restart: always
        ports:
            - '8080:8080'
        env_file:
            - .env
        volumes:
            - evolution_instances:/evolution/instances
    app:
        container_name: 'app'
        build: .
        restart: always
        env_file: .env
volumes:
    db-data:
    redis-data:
    evolution_instances:
